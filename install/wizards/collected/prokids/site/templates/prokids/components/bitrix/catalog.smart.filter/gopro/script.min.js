/*
 * Copyright (c) 16/12/2019 Created By/Edited By ASDAFF asdaff.asad@yandex.ru
 */

var CollectJS_tamautID=0,CollectJS_timeoutDelay=1200,CollectJS_inputter,CollectJS_modef_delay_hide=4000,CollectJS_modef_posFix=0;var CollectJS_filtren,CollectJS_offsetTopFilter=0,CollectJS_offsetTopFilterH=0,CollectJS_content,CollectJS_offsetTopContent=0,CollectJS_offsetTopContentH=0;function CollectJS_priceGoupClick(){if($(".filtren").hasClass("ajaxfilter")){CollectJS_FilterAjax()}}function CollectJS_SeachProp(c){var b=c.val();var a=c.parents(".lvl1");if(b.length<1){a.find(".lvl2").css("display","block")}else{a.find(".lvl2").each(function(){var d=$(this).find("label").html().substr(0,b.length);if(b.toLowerCase()==d.toLowerCase()){$(this).css("display","block")}else{$(this).css("display","none")}})}if(c.parents(".lvl1").hasClass("scrolable")){CollectJS_FilterJScrollPaneReinitialize()}}function CollectJS_FilterSetPropHide(){if($.cookie(BX_COOKIE_PREFIX+"COLLECTPRO_SMARTFILTER_SHOW_ALL")=="Y"){$(".filtren").addClass("opened")}var a="";$(".filtren").find("li.lvl1").removeClass("closed");$(".filtren").find("li.lvl1").each(function(b){a=$(this).data("propcode");if($.cookie(BX_COOKIE_PREFIX+"COLLECTPRO_SMARTFILTER_HIDE_"+a)=="Y"){$(this).addClass("closed")}})}function CollectJS_FilterJScrollPaneReinitialize(){var a;$(".f_jscrollpane").each(function(b){a=$(this).data("jsp");a.reinitialise()})}function CollectJS_BeforeSend(a){if(a=="disable"){$(".filtren").find(".min, .max").each(function(b){if(parseFloat($(this).data("startvalue"))==parseFloat($(this).val().replace(/[,]/g,".").replace(/[ ]+/g,""))){$(this).attr("disabled","disabled")}})}else{$(".filtren").find(".min, .max").removeAttr("disabled")}}function CollectJS_ReplaceProbel(){$(".filtren").find(".min, .max").each(function(a){$(this).val($(this).val().replace(/[ ]+/g,""))})}function CollectJS_ReturnProbel(){$(".filtren").find(".min, .max").each(function(a){$(this).val(CollectDevLib_NumberFormat($(this).val()))})}function CollectJS_FixedFilterWinScroll(){if(CollectJS_filtren&&CollectJS_filtren.length>0){CollectJS_offsetTopFilterH=CollectJS_offsetTopFilter+CollectJS_filtren.outerHeight(true);CollectJS_offsetTopContentH=CollectJS_content.offset().top+CollectJS_content.outerHeight(true);if(window.pageYOffset>CollectJS_offsetTopFilter){CollectJS_filtren.addClass("fixed")}else{CollectJS_filtren.removeClass("fixed")}if(window.pageYOffset+CollectJS_filtren.outerHeight(true)>CollectJS_content.offset().top+CollectJS_content.outerHeight(true)){CollectJS_filtren.addClass("stop").css("top",(CollectJS_offsetTopContentH-CollectJS_offsetTopFilterH)+"px")}else{CollectJS_filtren.removeClass("stop").css("top","0px")}}}function CollectJS_FixedFilter(){if(CollectJS_filtren&&CollectJS_filtren.length>0){CollectJS_offsetTopFilter=CollectJS_filtren.offset().top;CollectJS_offsetTopFilterH=CollectJS_offsetTopFilter+CollectJS_filtren.outerHeight(true);CollectJS_offsetTopContent=CollectJS_content.offset().top;CollectJS_offsetTopContentH=CollectJS_offsetTopContent+CollectJS_content.outerHeight(true);window.onscroll=CollectJS_FixedFilterWinScroll}}function CollectJS_FilterAjax(){clearTimeout(CollectJS_tamautID);CollectJS_tamautID=setTimeout(function(){CollectJS_Area2Darken($("#catalog"),"animashka");CollectJS_ReplaceProbel();CollectJS_BeforeSend("disable");var c=$("form.smartfilter");var b=c.serialize(),a=c.attr("action");if(a.indexOf("?")<1){a=a+"?"+b+"&AJAX_CALL=Y&get=catalog&set_filter=Y"}else{a=a+"&"+b+"&AJAX_CALL=Y&get=catalog&set_filter=Y"}BX.ajax({url:a,method:"GET",dataType:"html",scriptsRunFirst:false,emulateOnload:false,start:true,cache:false,onsuccess:function(d){$("#catalog").html(d);CollectJS_ScrollInit(".prices_jscrollpane");CollectJS_Area2Darken($("#catalog"));CollectJS_FilterOnDocumentReady()},onfailure:function(){CollectJS_Area2Darken($("#catalog"));CollectJS_FilterOnDocumentReady();console.warn("FILTER -> ajax load failed")}})},CollectJS_timeoutDelay)}function CollectJS_FilterOnDocumentReady(){CollectJS_FilterSetPropHide();$(document).on("click",".filtren .title a.shhi",function(){if($(".filtren").hasClass("opened")){$.removeCookie(BX_COOKIE_PREFIX+"COLLECTPRO_SMARTFILTER_SHOW_ALL");$(".filtren").removeClass("opened")}else{$.cookie(BX_COOKIE_PREFIX+"COLLECTPRO_SMARTFILTER_SHOW_ALL","Y","/");$(".filtren").addClass("opened")}CollectJS_FilterJScrollPaneReinitialize();CollectJS_FixedFilterWinScroll();return false});$(document).on("click",".filtren .showchild",function(){var b=$(this).parents("li.lvl1");var a=b.data("propcode");if(b.hasClass("closed")){$.removeCookie(BX_COOKIE_PREFIX+"COLLECTPRO_SMARTFILTER_HIDE_"+a);b.removeClass("closed")}else{$.cookie(BX_COOKIE_PREFIX+"COLLECTPRO_SMARTFILTER_HIDE_"+a,"Y","/");b.addClass("closed")}CollectJS_FilterJScrollPaneReinitialize();CollectJS_FixedFilterWinScroll();return false});$(document).on("click",".lvl2_disabled input, .lvl2_disabled label",function(a){a.stopPropagation();return false});setTimeout(function(){CollectJS_ReplaceProbel();var a;$(".filtren").find(".min, .max").on("keyup",function(b){clearTimeout(a);if(b.which!=8&&b.which!=37&&b.which!=39&&b.which!=191&&b.which!=190&&b.which!=188){var c=$(this);a=setTimeout(function(){$(this).val(CollectDevLib_NumberFormat(c.val()));smartFilter.keyup(BX(c.attr("id")))},1500)}}).each(function(){$(this).val(CollectDevLib_NumberFormat($(this).val()))})},25);$(".f_jscrollpane").jScrollPane();CollectJS_FilterJScrollPaneReinitialize();$(window).resize(function(){CollectJS_FilterJScrollPaneReinitialize()});$(document).on("keyup",".f_search",function(){var a=$(this);CollectJS_SeachProp(a)});$(document).on("click",".filtren .buttons .set_filter, .filtren .buttons .del_filter",function(){CollectJS_BeforeSend("disable");CollectJS_ReplaceProbel();if($(this).hasClass("set_filter")){$("#set_filter").click()}else{$("#del_filter").click()}return false});$(document).on("click","#modef a",function(){CollectJS_BeforeSend("disable");CollectJS_ReplaceProbel();$("#set_filter").click();return false});if(!CollectDevLib_PHONETABLET){CollectJS_filtren=$(".filtren.filterfixed"),CollectJS_offsetTopFilter=0,CollectJS_offsetTopFilterH=0,CollectJS_content=$(".content"),CollectJS_offsetTopContent=0,CollectJS_offsetTopContentH=0;CollectJS_FixedFilter()}}function CollectJS_FilterOnSubmitForm(){CollectJS_ReplaceProbel();CollectJS_BeforeSend("disable");return true}function JCSmartFilter(a){this.ajaxURL=a;this.form=null;this.timer=null}JCSmartFilter.prototype.keyup=function(a){if($(".filtren").hasClass("ajaxfilter")){CollectJS_FilterAjax()}else{if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),CollectJS_timeoutDelay)}};JCSmartFilter.prototype.click=function(a){if($(".filtren").hasClass("ajaxfilter")){CollectJS_FilterAjax()}else{if($(a).is(":checked")){$(".filtren").find('label[for="'+$(a).attr("id")+'"]').addClass("checked")}else{$(".filtren").find('label[for="'+$(a).attr("id")+'"]').removeClass("checked")}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),CollectJS_timeoutDelay)}};JCSmartFilter.prototype.reload=function(b){if(!CollectDevLib_PHONETABLET){CollectJS_inputter=b;var c=BX.pos(BX.findParent(b,{tag:"ul"}),true);CollectJS_Area2Darken($(b).closest(".filtren"),"animashka",{progressTop:c.top+c.height/2});this.position=BX.pos(b,true);this.form=BX.findParent(b,{tag:"form"});if(this.form){CollectJS_ReplaceProbel();CollectJS_BeforeSend("disable");var a=new Array;a[0]={name:"ajax",value:"y"};this.gatherInputsValues(a,BX.findChildren(this.form,{tag:"input"},true));BX.ajax.loadJSON(this.ajaxURL,this.values2post(a),BX.delegate(this.postHandler,this));CollectJS_ReturnProbel();CollectJS_BeforeSend()}}};JCSmartFilter.prototype.postHandler=function(m){clearInterval(CollectJS_tamautID);CollectJS_Area2Darken($(".filtren"));if(m.ITEMS){for(var a in m.ITEMS){var f=m.ITEMS[a];if(f.PROPERTY_TYPE=="N"||f.PRICE){}else{if(f.VALUES){for(var k in f.VALUES){var g=f.VALUES[k];var j=BX(g.CONTROL_ID);if(j){j.parentNode.className=g.DISABLED?"lvl2 lvl2_disabled":"lvl2"}}}}}var l=BX("modef");var h=BX("modef_num");if(l&&h){h.innerHTML=m.ELEMENT_COUNT;var e=BX.findChildren(l,{tag:"A"},true);if(m.FILTER_URL&&e){e[0].href=BX.util.htmlspecialcharsback(m.FILTER_URL)}if(m.FILTER_AJAX_URL&&m.COMPONENT_CONTAINER_ID){BX.bind(e[0],"click",function(n){var i=BX.util.htmlspecialcharsback(m.FILTER_AJAX_URL);BX.ajax.insertToNode(i,m.COMPONENT_CONTAINER_ID);return BX.PreventDefault(n)})}if(m.INSTANT_RELOAD&&m.COMPONENT_CONTAINER_ID){var c=BX.util.htmlspecialcharsback(m.FILTER_AJAX_URL);BX.ajax.insertToNode(c,m.COMPONENT_CONTAINER_ID)}else{if(l.style.display=="none"){l.style.display="block"}var b=this.position.top;if($(CollectJS_inputter).hasClass("min")||$(CollectJS_inputter).hasClass("max")){b=b+CollectJS_modef_posFix+1}else{if($(CollectJS_inputter).parents(".f_jscrollpane").length>0){var d=$(CollectJS_inputter).parents(".f_jscrollpane").attr("id");b=b+CollectJS_modef_posFix+BX(d).offsetTop-$("#"+d).data("jsp").getContentPositionY()}else{b=b+CollectJS_modef_posFix}}l.style.top=b+"px"}CollectJS_tamautID=setInterval(function(){l.style.display="none";clearInterval(CollectJS_tamautID)},CollectJS_modef_delay_hide)}}};JCSmartFilter.prototype.gatherInputsValues=function(a,e){if(e){for(var c=0;c<e.length;c++){var d=e[c];if(d.disabled||!d.type){continue}switch(d.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":if(d.value.length){a[a.length]={name:d.name,value:d.value}}break;case"radio":case"checkbox":if(d.checked){a[a.length]={name:d.name,value:d.value}}break;case"select-multiple":for(var b=0;b<d.options.length;b++){if(d.options[b].selected){a[a.length]={name:d.name,value:d.options[b].value}}}break;default:break}}}};JCSmartFilter.prototype.values2post=function(b){var e=new Array;var h=e;var d=0;while(d<b.length){var g=b[d].name.indexOf("[");if(g==-1){h[b[d].name]=b[d].value;h=e;d++}else{var c=b[d].name.substring(0,g);var f=b[d].name.substring(g+1);if(!h[c]){h[c]=new Array}var a=f.indexOf("]");if(a==-1){h=e;d++}else{if(a==0){h=h[c];b[d].name=""+h.length}else{h=h[c];b[d].name=f.substring(0,a)+f.substring(a+1)}}}}return e};$(document).ready(function(){CollectJS_FilterOnDocumentReady()});