var CollectJS_SetBuy1Click=false;function CollectJS_OnOfferChangeDetailSet(b){var d=b.find(".js-add2basketpid").val();var c=b.data("elementid");if(d>0){var a=false;$(".detailtabs .content.set").find(".aroundset.offer").addClass("noned");if($(".detailtabs .content.set").find(".aroundset.offerid"+d).length>0){$(".detailtabs .content.set").find(".aroundset.offerid"+d).removeClass("noned");a=true}if($(".detailtabs .content.set").find(".aroundset.simple").length>0){if(a){$(".detailtabs .content.set").find(".aroundset.simple").addClass("noned")}else{$(".detailtabs .content.set").find(".aroundset.simple").removeClass("noned")}}CollectJS_SetHideShowSwitcher()}}function CollectJS_SetHideShowSwitcher(){if($(".detailtabs").find(".content.set").find(".aroundset:not(.noned)").length>0){if($('.detailtabs .switcher[href="#set"]').length>0){$('.detailtabs .switcher[href="#set"]').removeAttr("style")}}else{if($('.detailtabs .switcher[href="#set"]').length>0){$('.detailtabs .switcher[href="#set"]').hide();if($('.detailtabs .switcher[href="#set"]').hasClass("selected")){$(".detailtabs").find(".switcher:first").trigger("click")}}}CollectJS_ScrollReinit(".set_jscrollpane")}function CollectJS_SetRecalcPrices(c){var a=0,d=0,b=0;c.find(".items.line1").find(".js-element").each(function(e){a+=+$(this).data("price");d+=+$(this).data("oldprice");b+=+$(this).data("discount")});BX.ajax.post(c.data("ajaxpath"),{sessid:BX.bitrix_sessid(),action:"ajax_recount_prices",sumPrice:a,sumOldPrice:d,sumDiffDiscountPrice:b,currency:c.data("currency")},function(e){CollectJS_Area2Darken(c);var f=JSON.parse(e);if(f.formatSum){c.find(".fullpanel").find(".price.new").html(f.formatSum)}if(f.formatOldSum){c.find(".fullpanel").find(".price.old").html(f.formatOldSum).show()}else{c.find(".fullpanel").find(".price.old").hide()}if(f.formatDiscDiffSum){c.find(".fullpanel").find(".diff").html(f.formatDiscDiffSum).parent().show()}else{c.find(".fullpanel").find(".discount").hide()}})}function CollectJS_SetAddRemoveItem(b){var f=4;var d=b.parents(".js-set");var a=b.parents(".js-element");var e=d.find(".items.line1").find(".js-element").length;var c=a.data("elementid");if(b.hasClass("in")){CollectJS_Area2Darken(d,"animashka");d.find(".items.line1").find(".js-elementid"+c).remove();b.removeClass("in");CollectJS_SetRecalcPrices(d)}else{if(e<f){CollectJS_Area2Darken(d,"animashka");b.addClass("in");d.find(".items.line1").find(".sliderin").append(d.find(".items.line2").find(".js-elementid"+c).clone());CollectJS_SetRecalcPrices(d)}}CollectJS_ScrollReinit(".set_jscrollpane")}$(document).ready(function(){CollectJS_SetHideShowSwitcher();var a=$(".detailtabs .aroundset");var b=0;var c=0;a.each(function(){b=$(this).find(".line1 .sliderin .js-element").length;c=$(this).find(".line1 .sliderin .js-element").filter(":first").outerWidth(true);$(this).find(".line1 .sliderin").css({width:(b*c)+"px"});b=$(this).find(".line2 .sliderin .js-element").length;c=$(this).find(".line2 .sliderin .js-element").filter(":first").outerWidth(true);$(this).find(".line2 .sliderin").css({width:(b*c)+"px"})});CollectJS_ScrollInit(".set_jscrollpane");$(window).resize(function(){CollectJS_ScrollReinit(".set_jscrollpane")});$(document).on("click",".js-set .massadd2basket",function(){var e=$(this).parents(".js-set");CollectJS_Area2Darken(e.find(".fullpanel"),"animashka");CollectJS_Area2Darken($("#header").find(".basketinhead"));var d=new Array();e.find(".items.line1").find(".js-element").each(function(f){d.push($(this).data("elementid"))});BX.ajax.post(e.data("ajaxpath"),{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:d,lid:e.data("lid"),iblockId:e.data("iblockid"),setOffersCartProps:e.data("setOffersCartProps")},function(f){var g=JSON.parse(f);CollectJS_PutJSon(g);CollectJS_Area2Darken(e.find(".fullpanel"));CollectJS_Area2Darken($("#header").find(".basketinhead"))});return false});$(document).on("click",".js-set .delete",function(){var d=$(this).parents(".js-element").data("elementid");$(this).parents(".js-set").find(".items.line2").find(".js-elementid"+d).find(".checkbox").trigger("click");return false});$(document).on("click",".js-set .checkbox",function(){CollectJS_SetAddRemoveItem($(this));return false});$(document).on("click","a.myset",function(){var d=$(this).parents(".js-set").find(".items.line2");if(d.length>0){d.toggleClass("noned");CollectJS_ScrollReinit(".set_jscrollpane")}return false});$(document).on("detaltabchange",function(){CollectJS_ScrollReinit(".set_jscrollpane")});$(document).on("CollectProOnOfferChange",function(f,d){CollectJS_OnOfferChangeDetailSet(d)});$(document).on("click",".buy1click.set",function(d){CollectJS_SetBuy1Click=true});$(document).on("CollectProOnFancyBeforeShow",function(){if(CollectJS_SetBuy1Click){var d="";d+=BX.message("CollectJS_SET_NABOR")+"\n-----------------------------------------------------";$(".aroundset:not(.noned)").find(".items.line1").find(".js-element").each(function(e){d+="\n"+BX.message("CollectJS_SET_PROD_ID")+": "+$(this).data("elementid")+"\n"+BX.message("CollectJS_SET_PROD_NAME")+": "+$(this).data("elementname")+"\n"+BX.message("CollectJS_SET_PROD_LINK")+": "+($(this).find(".setitemlink").length>0?(window.location.protocol+"//"+window.location.host+$(this).find(".setitemlink").attr("href")):window.location.href)+"\n-----------------------------------------------------"});$(".fancybox-inner").find('textarea[name="RS_AUTHOR_ORDER_LIST"]').text(d)}CollectJS_SetBuy1Click=false})});