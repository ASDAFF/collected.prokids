var CollectJS_OffersExt_timeout_id=0;function CollectJS_OffersExt_ChangeHTML(f){var b=f.data("elementid");if(CollectJS_OFFERS[b]){var g=new Object();f.find(".div_option.selected").each(function(m){var j=$(this);var k=j.parents(".offer_prop").data("code");var l=j.data("value");g[k]=l});var a=0;var i=true;for(offerID in CollectJS_OFFERS[b].OFFERS){i=true;for(pCode in g){if(g[pCode]!=CollectJS_OFFERS[b].OFFERS[offerID].PROPERTIES[pCode]){i=false;break}}if(i){a=offerID;break}}if(f.find(".offer_article")){if(CollectJS_OFFERS[b].OFFERS[a].ARTICLE){f.find(".offer_article").html(CollectJS_OFFERS[b].OFFERS[a].ARTICLE).parent().css("visibility","visible")}else{if(f.find(".offer_article").data("prodarticle")){f.find(".offer_article").html(f.find(".offer_article").data("prodarticle")).parent().css("visibility","visible")}else{f.find(".offer_article").parent().css("visibility","hidden")}}}if(CollectJS_OFFERS[b].OFFERS[a].PRICES){var d=CollectJS_OFFERS[b].OFFERS[a].PRICES;for(var e in d){if(f.find(".price_pdv_"+e)){f.find(".price_pdv_"+e).removeClass("new").html(d[e].PRINT_DISCOUNT_VALUE);if(parseInt(d[e].DISCOUNT_DIFF)>0){f.find(".price_pdv_"+e).addClass("new")}}if(f.find(".price_pd_"+e)){if(parseInt(d[e].DISCOUNT_DIFF)>0){f.find(".price_pd_"+e).html(d[e].PRINT_DISCOUNT)}else{f.find(".price_pd_"+e).html("")}}if(f.find(".price_pv_"+e)){if(parseInt(d[e].DISCOUNT_DIFF)>0){f.find(".price_pv_"+e).html(d[e].PRINT_VALUE)}else{f.find(".price_pv_"+e).html("")}}}}if(CollectJS_OFFERS[b].OFFERS[a].CATALOG_MEASURE_RATIO&&f.find(".js-quantity")){f.find(".js-quantity").data("ratio",CollectJS_OFFERS[b].OFFERS[a].CATALOG_MEASURE_RATIO);f.find(".js-quantity").val(f.find(".js-quantity").data("ratio"))}if(CollectJS_OFFERS[b].OFFERS[a].CATALOG_MEASURE_NAME&&f.find(".js-measurename")){f.find(".js-measurename").html(CollectJS_OFFERS[b].OFFERS[a].CATALOG_MEASURE_NAME)}f.removeClass("qb da2");f.find(".timers .timer").hide();if(CollectJS_OFFERS[b].ELEMENT.QUICKBUY||CollectJS_OFFERS[b].OFFERS[a].QUICKBUY){f.addClass("qb");if(f.find(".timers .qb.js-timer_id"+b).length>0){f.find(".timers .qb.js-timer_id"+b).css("display","inline-block")}else{if(f.find(".timers .qb.js-timer_id"+a).length>0){f.find(".timers .qb.js-timer_id"+a).css("display","inline-block")}}}if(CollectJS_OFFERS[b].ELEMENT.DAYSARTICLE2||CollectJS_OFFERS[b].OFFERS[a].DAYSARTICLE2){f.removeClass("qb").addClass("da2");if(f.find(".timers .da2.js-timer_id"+b).length>0){f.find(".timers .timer").hide();f.find(".timers .da2.js-timer_id"+b).css("display","inline-block")}else{if(f.find(".timers .da2.js-timer_id"+a).length>0){f.find(".timers .timer").hide();f.find(".timers .da2.js-timer_id"+a).css("display","inline-block")}}}f.find(".js-add2basketpid").val(a);if(CollectJS_OFFERS[b].OFFERS[a].CAN_BUY){f.find(".add2basketform").removeClass("cantbuy")}else{f.find(".add2basketform").addClass("cantbuy")}if(f.find(".stores")&&a>0&&f.find(".stores").find(".popupstores")){if(CollectJS_STOCK[b]){if(f.find(".stores").hasClass("gopro_20")){for(storeID in CollectJS_STOCK[b].JS.SKU[a]){var h=CollectJS_STOCK[b].JS.SKU[a];var c=h[storeID];if(CollectJS_STOCK[b].USE_MIN_AMOUNT==true){if(c<1){f.find(".stores").find(".store_"+storeID).find(".amount").css("color","#ff0000").html(CollectJS_STOCK[b].MESSAGE_EMPTY)}else{if(c<CollectJS_STOCK[b].MIN_AMOUNT){f.find(".stores").find(".store_"+storeID).find(".amount").css("color","").html(CollectJS_STOCK[b].MESSAGE_LOW)}else{f.find(".stores").find(".store_"+storeID).find(".amount").css("color","#00cc00").html(CollectJS_STOCK[b].MESSAGE_ISSET)}}}else{f.find(".stores").find(".store_"+storeID).find(".amount").html(c)}if(CollectJS_STOCK[b].SHOW_EMPTY_STORE==false&&c<1){f.find(".stores").find(".store_"+storeID).hide()}else{f.find(".stores").find(".store_"+storeID).show()}}}else{console.warn("OffersExt_ChangeHTML -> old stores template version");f.find(".stores").find(".genamount").removeClass("cantopen");f.find(".stores").find(".popupstores").find(".offerstore").hide();if(f.find(".stores").find(".popupstores").find(".offer_"+a).length>0){f.find(".stores").find(".popupstores").find(".offer_"+a).show()}else{f.find(".stores").find(".genamount").addClass("cantopen")}}if(CollectJS_STOCK[b].QUANTITY[b]){var c=parseInt(CollectJS_STOCK[b].QUANTITY[a]);if(CollectJS_STOCK[b].USE_MIN_AMOUNT==true){if(c<1){f.find(".stores").find(".genamount span").css("color","#ff0000").html(CollectJS_STOCK[b].MESSAGE_EMPTY)}else{if(c<CollectJS_STOCK[b].MIN_AMOUNT){f.find(".stores").find(".genamount span").css("color","").html(CollectJS_STOCK[b].MESSAGE_LOW)}else{f.find(".stores").find(".genamount span").css("color","#00cc00").html(CollectJS_STOCK[b].MESSAGE_ISSET)}}}else{f.find(".stores").find(".genamount span").html(c)}}}else{console.warn("OffersExt_ChangeHTML -> store not found")}}CollectJS_SetInBasket();$(document).trigger("CollectProOnOfferChange",[f])}}function CollectJS_OffersExt_PropChanged(j){var a=j.parents(".js-element").data("elementid");var k=j.parents(".offer_prop").data("code");var e=j.data("value");if(CollectJS_OFFERS[a]&&!j.hasClass("disabled")){j.parents(".offer_prop").removeClass("opened").addClass("closed");j.parents(".offer_prop").find(".div_option").removeClass("selected");j.addClass("selected");if(j.parents(".offer_prop").hasClass("color")){j.parents(".offer_prop").find(".div_selected span").css({backgroundImage:j.find("span").css("backgroundImage")})}else{j.parents(".offer_prop").find(".div_selected span").html(e)}var i=0;var d="";var g="";var h=new Object();for(index in CollectJS_OFFERS[a].SORT_PROPS){g=CollectJS_OFFERS[a].SORT_PROPS[index];h[g]=j.parents(".js-element").find(".prop_"+g).find(".div_option.selected").data("value");if(g==k){var i=parseInt(index)+1;if(CollectJS_OFFERS[a].SORT_PROPS[i]){d=CollectJS_OFFERS[a].SORT_PROPS[i]}else{d=false}break}}if(d){var f=true;var c=new Array();for(offerID in CollectJS_OFFERS[a].OFFERS){f=true;for(pCode1 in h){if(h[pCode1]!=CollectJS_OFFERS[a].OFFERS[offerID].PROPERTIES[pCode1]){f=false}}if(f){c.push(CollectJS_OFFERS[a].OFFERS[offerID].PROPERTIES[d])}}j.parents(".js-element").find(".prop_"+d).find(".div_option").each(function(m){var n=$(this);var l=true;for(inden in c){if(n.data("value")==c[inden]){l=false;break}}n.addClass("disabled");if(!l){n.removeClass("disabled")}});var b;if(!j.parents(".js-element").find(".prop_"+d).find(".div_option.selected").hasClass("disabled")){b=j.parents(".js-element").find(".prop_"+d).find(".div_option.selected")}else{b=j.parents(".js-element").find(".prop_"+d).find(".div_option:not(.disabled):first")}CollectJS_OffersExt_PropChanged(b)}else{CollectJS_OffersExt_ChangeHTML(j.parents(".js-element"))}}}$(document).ready(function(){$(document).on("click",".div_option",function(f){f.stopPropagation();clearTimeout(CollectJS_OffersExt_timeout_id);var c=$(this);if(!c.hasClass("disabled")){var a=c.parents(".js-element").data("elementid");if(a>0){var g=c.parents(".offer_prop").data("code");var d=c.data("value");if(CollectJS_OFFERS[a]){CollectJS_OffersExt_PropChanged(c)}else{CollectJS_Area2Darken(c.parents(".js-element"),"animashka");var b=SITE_DIR+"catalog/?AJAX_CALL=Y&action=get_element_json&element_id="+a;$.getJSON(b,{},function(e){CollectJS_OFFERS[a]=e;CollectJS_OffersExt_PropChanged(c);CollectJS_Area2Darken(c.parents(".js-element"))}).fail(function(e){console.warn("Get element JSON -> fail request");CollectJS_Area2Darken(c.parents(".js-element"))})}}else{console.warn("Get element JSON -> element_id is empty")}}return false});$(document).on("click",".div_selected",function(a){$(".offer_prop.opened:not(.prop_"+$(this).parents(".offer_prop").data("code")+")").removeClass("opened").addClass("closed");if($(this).parents(".offer_prop").hasClass("closed")){$(this).parents(".offer_prop").removeClass("closed").addClass("opened")}else{$(this).parents(".offer_prop").removeClass("opened").addClass("closed")}return false});$(document).on("click",function(a){if($(a.target).parents(".offer_prop").length>0&&!$(a.target).parents(".offer_prop").hasClass("color")){}else{$(".offer_prop").removeClass("opened").addClass("closed")}})});